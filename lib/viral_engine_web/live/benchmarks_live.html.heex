<div class="benchmarks-dashboard">
  <h1>AI Provider Benchmarks</h1>

  <div class="dashboard-content">
    <div class="create-benchmark-section">
      <h2>Create New Benchmark</h2>

      <div class="suite-selector">
        <h3>Choose a Pre-configured Suite:</h3>
        <div class="suites-grid">
          <%= for {key, suite} <- @suites do %>
            <div class={"suite-card #{if @selected_suite == key, do: "selected", else: ""}"}>
                 phx-click="select_suite" phx-value-suite={key}>
              <h4><%= suite.name %></h4>
              <p><%= String.slice(suite.prompt, 0, 100) %>...</p>
              <div class="providers">
                <%= for provider <- suite.providers do %>
                  <span class="provider-tag"><%= provider %></span>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <form phx-submit="create_benchmark" class="benchmark-form">
        <div class="form-group">
          <label for="name">Benchmark Name:</label>
          <input type="text" name="benchmark[name]" id="name"
                 value={@form_data[:name] || ""} required />
        </div>

        <div class="form-group">
          <label for="prompt">Prompt:</label>
          <textarea name="benchmark[prompt]" id="prompt" rows="4" required><%= @form_data[:prompt] || "" %></textarea>
        </div>

        <div class="form-group">
          <label>Providers:</label>
          <div class="providers-checkboxes">
            <%= for provider <- ["openai", "groq", "perplexity"] do %>
              <label class="provider-checkbox">
                <input type="checkbox" name="benchmark[providers][]" value={provider}
                       {if @form_data[:providers] && provider in (@form_data[:providers] || []), do: [checked: true], else: []} />
                <%= String.capitalize(provider) %>
              </label>
            <% end %>
          </div>
        </div>

        <button type="submit" class="btn-create">Create & Run Benchmark</button>
      </form>
    </div>

    <div class="benchmarks-list-section">
      <h2>Recent Benchmarks</h2>

      <div class="benchmarks-table">
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Suite</th>
              <th>Providers</th>
              <th>Status</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <%= for benchmark <- @benchmarks do %>
              <tr class={"benchmark-row #{get_status(benchmark, @running_benchmark)}"}>
                <td><%= benchmark.name %></td>
                <td><%= benchmark.suite || "Custom" %></td>
                <td>
                  <div class="provider-tags">
                    <%= for provider <- benchmark.providers do %>
                      <span class="provider-tag"><%= provider %></span>
                    <% end %>
                  </div>
                </td>
                <td>
                  <span class={"status-badge #{get_status(benchmark, @running_benchmark)}"}>
                    <%= String.capitalize(get_status(benchmark, @running_benchmark)) %>
                  </span>
                </td>
                <td><%= Calendar.strftime(benchmark.inserted_at, "%Y-%m-%d %H:%M") %></td>
                <td>
                  <%= if get_status(benchmark, @running_benchmark) == "completed" and benchmark.results do %>
                    <button onclick={"showResults(#{benchmark.id})"} class="btn-results">View Results</button>
                  <% else %>
                    <button phx-click="run_benchmark" phx-value-benchmark_id={benchmark.id}
                            class="btn-run" {if @running_benchmark, do: [disabled: true], else: []}>Run</button>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>

    <%= if @benchmark_results do %>
      <div class="results-section">
        <h2>Latest Benchmark Results</h2>

        <div class="results-summary">
          <div class="stats-card">
            <h3>Statistics</h3>
            <p>Sample Size: <%= @benchmark_results.stats.sample_size %></p>
            <p>Latency Range: <%= format_latency(@benchmark_results.stats.latency_stats.min) %> - <%= format_latency(@benchmark_results.stats.latency_stats.max) %></p>
            <p>Cost Range: <%= format_cost(@benchmark_results.stats.cost_stats.min) %> - <%= format_cost(@benchmark_results.stats.cost_stats.max) %></p>
          </div>
        </div>

        <div class="results-table">
          <table>
            <thead>
              <tr>
                <th>Provider</th>
                <th>Success</th>
                <th>Latency</th>
                <th>Cost</th>
                <th>Tokens</th>
                <th>Your Rating</th>
              </tr>
            </thead>
            <tbody>
              <%= for result <- @benchmark_results.results do %>
                <tr>
                  <td><%= result.provider %></td>
                  <td>
                    <%= if result.success do %>
                      <span class="success">✓</span>
                    <% else %>
                      <span class="error">✗</span>
                    <% end %>
                  </td>
                  <td><%= format_latency(result.latency_ms) %></td>
                  <td><%= format_cost(result.cost) %></td>
                  <td><%= result.tokens_used %></td>
                  <td>
                    <div class="rating-stars">
                      <%= for star <- 1..5 do %>
                        <span class="star" phx-click="rate_result"
                              phx-value-benchmark_id="latest"
                              phx-value-provider={result.provider}
                              phx-value-rating={star}>★</span>
                      <% end %>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>

        <div class="comparisons">
          <h3>Provider Comparisons</h3>
          <%= for comparison <- @benchmark_results.stats.significance_tests.comparisons do %>
            <div class="comparison">
              <strong><%= comparison.comparison %></strong>:
              <%= comparison.faster_provider %> was faster by <%= format_latency(abs(comparison.latency_diff)) %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<script>
function showResults(benchmarkId) {
  // In a real implementation, you'd show detailed results
  alert("Showing detailed results for benchmark: " + benchmarkId);
}
</script>

<style>
.benchmarks-dashboard {
  padding: 20px;
  max-width: 1200px;
  margin: 0 auto;
}

.suites-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.suite-card {
  border: 2px solid #ddd;
  border-radius: 8px;
  padding: 20px;
  cursor: pointer;
  transition: border-color 0.3s;
}

.suite-card:hover, .suite-card.selected {
  border-color: #2196f3;
}

.provider-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
  margin-top: 10px;
}

.provider-tag {
  background: #e3f2fd;
  color: #1976d2;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 12px;
}

.benchmark-form {
  background: #f9f9f9;
  padding: 20px;
  border-radius: 8px;
  margin-top: 20px;
}

.form-group {
  margin-bottom: 15px;
}

.form-group label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
}

.form-group input, .form-group textarea {
  width: 100%;
  padding: 8px;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.providers-checkboxes {
  display: flex;
  gap: 15px;
}

.provider-checkbox {
  display: flex;
  align-items: center;
  gap: 5px;
}

.btn-create, .btn-run, .btn-results {
  background: #2196f3;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 4px;
  cursor: pointer;
}

.btn-create:hover, .btn-run:hover, .btn-results:hover {
  background: #1976d2;
}

.benchmarks-table table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

.benchmarks-table th, .benchmarks-table td {
  padding: 12px;
  text-align: left;
  border-bottom: 1px solid #ddd;
}

.status-badge {
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: bold;
}

.status-badge.pending { background: #fff3e0; color: #f57c00; }
.status-badge.running { background: #e3f2fd; color: #1976d2; }
.status-badge.completed { background: #e8f5e8; color: #388e3c; }

.results-section {
  margin-top: 40px;
  padding: 20px;
  background: #f9f9f9;
  border-radius: 8px;
}

.stats-card {
  background: white;
  padding: 20px;
  border-radius: 8px;
  margin-bottom: 20px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.results-table {
  margin: 20px 0;
}

.rating-stars {
  display: flex;
  gap: 2px;
}

.star {
  color: #ddd;
  cursor: pointer;
  font-size: 18px;
}

.star:hover, .star:hover ~ .star {
  color: #ffc107;
}

.comparisons {
  margin-top: 20px;
}

.comparison {
  background: white;
  padding: 10px;
  margin: 5px 0;
  border-radius: 4px;
  border-left: 4px solid #2196f3;
}

.success { color: #388e3c; font-weight: bold; }
.error { color: #d32f2f; font-weight: bold; }
</style>